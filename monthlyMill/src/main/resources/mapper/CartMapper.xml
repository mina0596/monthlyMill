<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="project.monthlyMill.customer.shoppingCart.CartMapper">
	<resultMap type="Cart"	id="cartResultMap">
		<result property="cartNum"			column="cart_num"/>
		<result property="memberNum"		column="member_num"/>
		<result property="pCode"			column="product_code"/>
		<result property="pAmount"			column="amount"/>
		<result property="cartRegDate"		column="cart_reg_date"/>
		<result property="orderCheck"		column="order_check"/>
	</resultMap>
	
	<insert id="addItem" parameterType="map">
		INSERT INTO member_cart
		(cart_num, member_num, product_code, amount, cart_reg_date, order_check, delete_check)
		VALUES (0, #{memberNum}, #{pCode}, 1, CURDATE(), 'N', 'N');
	</insert>
	
	<select id="getCartListByMemberNum" parameterType="String" resultType="map">
		SELECT
			mCart.cart_num as cartNum,
			mCart.product_code as pCode, 
			mCart.amount as pAmount, 
			pInfo.product_name as pName, 
			pInfo.product_price as pPrice,
			pInfo.default_shipping_fee as defaultShippingFee
		FROM 
			member_cart AS mCart
		INNER JOIN 
			product_info AS pInfo
		ON 
			mCart.product_code = pInfo.product_code
		LEFT JOIN
			order_info AS oInfo
		on
			mCart.cart_num = oInfo.cart_num
		WHERE member_num = #{memberNum} and mCart.order_check='N' and mCart.delete_check='N'
		ORDER BY cartNum ASC;
	</select>
	
	<update id="updateCartByCartNum" parameterType="map">
		UPDATE member_cart
		SET
			amount=#{pAmount}
		WHERE cart_num=#{cartNum}
	</update>
	
</mapper>